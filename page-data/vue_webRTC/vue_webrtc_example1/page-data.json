{"componentChunkName":"component---src-templates-post-template-tsx","path":"/vue_webRTC/vue_webrtc_example1/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>프로젝트 개요</h2>\n<p>본 미니프로젝트에서는 Vue와 WebRTC 기술을 결합해서 실시간으로 비디오 데이터를 주고 받는 앱을 만들어보려고 합니다.\n구글 코드랩 튜토리얼을 하나씩 Vue 프레임워크에 적용해가면서, 궁극적으로는 같은 네트워크내에 있는<br>\n한 사용자가 세션을 만들어 영상을 띄우면, 다른 사용자는 세션에 접속하여 해당 영상을 시청하는 형태로 구현을 하고자합니다.</p>\n<h3>설치 필요</h3>\n<ol>\n<li>Node.js</li>\n<li>Vue &#x26; Vue CLI 3</li>\n</ol>\n<h2>개발환경 셋팅</h2>\n<ul>\n<li>Node 터미널 혹은 iTerminal을 열고, <code class=\"language-text\">vue create vueRTC</code>로 폴더를 만들고 Vue 프로젝트를 시작</li>\n<li>선택한 옵션은 아래와 같음:\n<ol>\n<li>Router</li>\n<li>Vuex</li>\n<li>CSS Pre-processors</li>\n<li>PWA</li>\n</ol>\n</li>\n<li><code class=\"language-text\">history mode</code>는 <code class=\"language-text\">y</code>를 입력해서 사용하도록 설정 (Vue-router 관련)</li>\n<li>설치 완료 후, <code class=\"language-text\">vue add vuetify</code>를 입력해서 Vuetify 설치하기\n<ul>\n<li>디폴트 프리셋 사용</li>\n</ul>\n</li>\n<li><code class=\"language-text\">npm install webrtc-adapter --save</code>로 WebRTC의 웹 호환성을 위한 어댑터 설치\n<ul>\n<li>설치 후, main.js 파일에 <code class=\"language-text\">import adapter from 'webrtc-adapter';</code> 추가</li>\n</ul>\n</li>\n<li>WebRTC의 MediaStream 기능은 <code class=\"language-text\">https</code>와 같이 Secured 상태에서만 작동함\n<ul>\n<li>Vue 개발서버가 <code class=\"language-text\">https</code>에서 실행되도록 설정</li>\n<li><code class=\"language-text\">vue.config.js</code> 파일 생성 후 다음을 추가</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">devServer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">https</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2>HTML 화면 구성</h2>\n<ul>\n<li>Vuetify를 사용해서 화면을 구현 할꺼임</li>\n<li><code class=\"language-text\">v-flex</code> 사이즈는 <code class=\"language-text\">xs12</code>로 고정해서, 모든 화면에서 X축으로 최대 값을 가지도록 설정</li>\n<li>영상을 띄우기 위해, <code class=\"language-text\">&lt;video></code> 태그를 추가\n<ul>\n<li><code class=\"language-text\">autoplay</code> 옵션을 넣어서, 비디오가 연결되면 자동 재생되도록 설정</li>\n<li>없으면 재생이 안되고 한 프레임만 캡쳐되서 나옴…</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>v-container</span> <span class=\"token attr-name\">grid-list-md</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>v-layout</span> <span class=\"token attr-name\">text-center</span> <span class=\"token attr-name\">wrap</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>v-flex</span> <span class=\"token attr-name\">xs12</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span> Video Player <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>v-flex</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>v-flex</span> <span class=\"token attr-name\">xs12</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span>\n          <span class=\"token attr-name\">autoplay</span>\n          <span class=\"token attr-name\">playsinline</span>\n          <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>video</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>v-flex</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>v-layout</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>v-container</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<hr>\n<h2>MediaStream API 적용</h2>\n<ul>\n<li>\n<ul>\n<li><code class=\"language-text\">getUserMedia()</code>\n<ul>\n<li>웹에서 유저가 카메라 사용을 허용하도록 prompt를 띄움</li>\n<li>허용 혹은 거절 가능</li>\n<li>허용시 <code class=\"language-text\">MediaStream</code> 객체가 반환되고, <code class=\"language-text\">srcObject</code> 속성을 통해서 이 객체에 접근이 가능\n<ul>\n<li><code class=\"language-text\">video.srcObject = mediastream</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">MediaTrackConstraints</code> = media로 사용이 가능한 제한요소들</p>\n<ul>\n<li>보통 <code class=\"language-text\">video</code>와 <code class=\"language-text\">audio</code>가 있음</li>\n<li>만약 제한요소가 현재 유저의 시스템과 맞지 않으면, <code class=\"language-text\">OverconstrainedError</code>를 반환하고, 카메라에 접근이 취소됨</li>\n</ul>\n</li>\n</ul>\n<h3>Data 객체 정의</h3>\n<ul>\n<li>Vue script내에서 특정 변수를 가져다가 쓰려면, data 객체에 먼저 정의해야함</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 비디오 영상을 담을 변수 정의</span>\n    <span class=\"token literal-property property\">video</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// MediaTrackConstraints를 변수로 정의</span>\n    <span class=\"token literal-property property\">mediaContraint</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">video</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>함수 정의</h3>\n<ul>\n<li>Vue 라이프사이클에 따라 사용자에게 화면이 생성되면 (즉, mounted 시점) 바로 유저의 영상장치를 확인하고, 사용을 허가하도록 prompt를 띄움</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Vue component가 mount되면 실행</span>\n  <span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// refs가 video인 html element를 data property의 video에 저장</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>video <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>video\n\n    <span class=\"token comment\">// mediaDevice 요청해서 있으면 실행</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>navigator<span class=\"token punctuation\">.</span>mediaDevices <span class=\"token operator\">&amp;&amp;</span> navigator<span class=\"token punctuation\">.</span>mediaDevices<span class=\"token punctuation\">.</span>getUserMedia<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      navigator<span class=\"token punctuation\">.</span>mediaDevices\n        <span class=\"token punctuation\">.</span><span class=\"token function\">getUserMedia</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">video</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 미디어 객체를 this.video 즉 HTML의 ref가 video인 요소에 반환</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>video<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> stream\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>video<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'navigator.getUserMedia error: '</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2>마무리</h2>\n<p>다음에는 RTCPeerConnection을 구현해서 로컬 영상을 복제하여 띄워주려고함.</p>","frontmatter":{"title":"[Vue+WebRTC] (1) 웹캠 화면 띄우기","excerpt":"Vue 프레임워크에 WebRTC 기술을 적용하여 웹캠 스트리밍 어플을 만드는 과정을 설명합니다.","date":"2019.07.28.","category":"vueRTC","thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQHA//EABYBAQEBAAAAAAAAAAAAAAAAAAEFCP/aAAwDAQACEAMQAAABQVqO8vPstKWJ/8QAGRAAAwEBAQAAAAAAAAAAAAAAAAIEFBID/9oACAEBAAEFAkmXryiqRcxkHn7Mh//EACIRAAEBBgcAAAAAAAAAAAAAAAERAAIDFiIxEiEyUVJxkf/aAAgBAwEBPwGYIiGu+HdaStJsFs8uoZNMETmfem//xAAgEQABAwIHAAAAAAAAAAAAAAABABEhFjIzQVFSYWOh/9oACAECAQE/AaqL4rCHDnKQ2k3bhCqvs9PC/8QAJRAAAAQEBQUAAAAAAAAAAAAAAQIDEgAEETEQEyIyoRQhQWGC/9oACAEBAAY/Ai5gCyoPbub5p7Dm0LdaVMD54py2TtVl07zg1EWlmHFBFK5GKOE3aLYBoIWgU01t9GNxS8Wj/8QAHBABAQACAwEBAAAAAAAAAAAAEQEAITFxkVGx/9oACAEBAAE/IenPPJs2BuSwH04VvZWxLUmtQdXTHjrPZn6sjAOgbIG2uDq9mf/aAAwDAQACAAMAAAAQIP8A/8QAHREBAQABBAMAAAAAAAAAAAAAAREhQVFhcZGhwf/aAAgBAwEBPxAm2btGIgmVhMSiM9bq+uDx3P/EAB0RAQABBAMBAAAAAAAAAAAAAAERACExYUFRkfD/2gAIAQIBAT8QUCTMymd5OaS1hHipdOPo7fNNf//EABsQAQACAwEBAAAAAAAAAAAAAAEAESEx8BDR/9oACAEBAAE/EAOmhYSwV6tXyWUUGmjDjl/NZlUnqE7/ABh7GRxBASMMVHVwR4r/AP/Z"},"images":{"fallback":{"src":"/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/ffa24/logo.jpg","srcSet":"/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/d04ec/logo.jpg 256w,\n/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/6f7c6/logo.jpg 512w,\n/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/ffa24/logo.jpg 1024w","sizes":"(min-width: 1024px) 1024px, 100vw"},"sources":[{"srcSet":"/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/e92ac/logo.webp 256w,\n/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/dcf1b/logo.webp 512w,\n/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/afeb4/logo.webp 1024w","type":"image/webp","sizes":"(min-width: 1024px) 1024px, 100vw"}]},"width":1024,"height":768}},"publicURL":"/static/f7a2cb1b53db588bfdc14d4b5dcd2d35/logo.jpeg"}}}}]}},"pageContext":{"slug":"/vue_webRTC/vue_webrtc_example1/"}},"staticQueryHashes":[],"slicesMap":{}}